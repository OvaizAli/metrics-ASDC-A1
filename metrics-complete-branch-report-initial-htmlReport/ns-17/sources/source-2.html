


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > MetricsModule</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.codahale.metrics.json</a>
</div>

<h1>Coverage Summary for Class: MetricsModule (com.codahale.metrics.json)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">MetricsModule</td>
<td class="coverageStat">
  <span class="percent">
    87.5%
  </span>
  <span class="absValue">
    (7/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    92.3%
  </span>
  <span class="absValue">
    (12/13)
  </span>
</td>
</tr>
  <tr>
    <td class="name">MetricsModule$1</td>
  </tr>
  <tr>
    <td class="name">MetricsModule$CounterSerializer</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (5/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MetricsModule$GaugeSerializer</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (9/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MetricsModule$HistogramSerializer</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (19/19)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MetricsModule$MeterSerializer</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (11/11)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MetricsModule$MetricRegistrySerializer</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (11/11)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MetricsModule$TimerSerializer</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (33/33)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    96%
  </span>
  <span class="absValue">
    (24/25)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    99%
  </span>
  <span class="absValue">
    (100/101)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.codahale.metrics.json;
&nbsp;
&nbsp;import com.codahale.metrics.Counter;
&nbsp;import com.codahale.metrics.Gauge;
&nbsp;import com.codahale.metrics.Histogram;
&nbsp;import com.codahale.metrics.Meter;
&nbsp;import com.codahale.metrics.MetricFilter;
&nbsp;import com.codahale.metrics.MetricRegistry;
&nbsp;import com.codahale.metrics.Snapshot;
&nbsp;import com.codahale.metrics.Timer;
&nbsp;import com.fasterxml.jackson.core.JsonGenerator;
&nbsp;import com.fasterxml.jackson.core.Version;
&nbsp;import com.fasterxml.jackson.databind.Module;
&nbsp;import com.fasterxml.jackson.databind.SerializerProvider;
&nbsp;import com.fasterxml.jackson.databind.module.SimpleSerializers;
&nbsp;import com.fasterxml.jackson.databind.ser.std.StdSerializer;
&nbsp;
&nbsp;import java.io.IOException;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.Locale;
&nbsp;import java.util.concurrent.TimeUnit;
&nbsp;
<b class="fc">&nbsp;public class MetricsModule extends Module {</b>
<b class="fc">&nbsp;    static final Version VERSION = new Version(4, 0, 0, &quot;&quot;, &quot;io.dropwizard.metrics&quot;, &quot;metrics-json&quot;);</b>
&nbsp;
&nbsp;    @SuppressWarnings(&quot;rawtypes&quot;)
<b class="fc">&nbsp;    private static class GaugeSerializer extends StdSerializer&lt;Gauge&gt; {</b>
&nbsp;
&nbsp;        private static final long serialVersionUID = 1L;
&nbsp;
&nbsp;        private GaugeSerializer() {
<b class="fc">&nbsp;            super(Gauge.class);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void serialize(Gauge gauge,
&nbsp;                              JsonGenerator json,
&nbsp;                              SerializerProvider provider) throws IOException {
<b class="fc">&nbsp;            json.writeStartObject();</b>
&nbsp;            final Object value;
&nbsp;            try {
<b class="fc">&nbsp;                value = gauge.getValue();</b>
<b class="fc">&nbsp;                json.writeObjectField(&quot;value&quot;, value);</b>
<b class="fc">&nbsp;            } catch (RuntimeException e) {</b>
<b class="fc">&nbsp;                json.writeObjectField(&quot;error&quot;, e.toString());</b>
<b class="fc">&nbsp;            }</b>
<b class="fc">&nbsp;            json.writeEndObject();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    private static class CounterSerializer extends StdSerializer&lt;Counter&gt; {</b>
&nbsp;
&nbsp;        private static final long serialVersionUID = 1L;
&nbsp;
&nbsp;        private CounterSerializer() {
<b class="fc">&nbsp;            super(Counter.class);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void serialize(Counter counter,
&nbsp;                              JsonGenerator json,
&nbsp;                              SerializerProvider provider) throws IOException {
<b class="fc">&nbsp;            json.writeStartObject();</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;count&quot;, counter.getCount());</b>
<b class="fc">&nbsp;            json.writeEndObject();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    private static class HistogramSerializer extends StdSerializer&lt;Histogram&gt; {</b>
&nbsp;
&nbsp;        private static final long serialVersionUID = 1L;
&nbsp;
&nbsp;        private final boolean showSamples;
&nbsp;
&nbsp;        private HistogramSerializer(boolean showSamples) {
<b class="fc">&nbsp;            super(Histogram.class);</b>
<b class="fc">&nbsp;            this.showSamples = showSamples;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void serialize(Histogram histogram,
&nbsp;                              JsonGenerator json,
&nbsp;                              SerializerProvider provider) throws IOException {
<b class="fc">&nbsp;            json.writeStartObject();</b>
<b class="fc">&nbsp;            final Snapshot snapshot = histogram.getSnapshot();</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;count&quot;, histogram.getCount());</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;max&quot;, snapshot.getMax());</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;mean&quot;, snapshot.getMean());</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;min&quot;, snapshot.getMin());</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;p50&quot;, snapshot.getMedian());</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;p75&quot;, snapshot.get75thPercentile());</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;p95&quot;, snapshot.get95thPercentile());</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;p98&quot;, snapshot.get98thPercentile());</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;p99&quot;, snapshot.get99thPercentile());</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;p999&quot;, snapshot.get999thPercentile());</b>
&nbsp;
<b class="fc">&nbsp;            if (showSamples) {</b>
<b class="fc">&nbsp;                json.writeObjectField(&quot;values&quot;, snapshot.getValues());</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            json.writeNumberField(&quot;stddev&quot;, snapshot.getStdDev());</b>
<b class="fc">&nbsp;            json.writeEndObject();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private static class MeterSerializer extends StdSerializer&lt;Meter&gt; {
&nbsp;
&nbsp;        private static final long serialVersionUID = 1L;
&nbsp;
&nbsp;        private final String rateUnit;
&nbsp;        private final double rateFactor;
&nbsp;
&nbsp;        public MeterSerializer(TimeUnit rateUnit) {
<b class="fc">&nbsp;            super(Meter.class);</b>
<b class="fc">&nbsp;            this.rateFactor = rateUnit.toSeconds(1);</b>
<b class="fc">&nbsp;            this.rateUnit = calculateRateUnit(rateUnit, &quot;events&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void serialize(Meter meter,
&nbsp;                              JsonGenerator json,
&nbsp;                              SerializerProvider provider) throws IOException {
<b class="fc">&nbsp;            json.writeStartObject();</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;count&quot;, meter.getCount());</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;m15_rate&quot;, meter.getFifteenMinuteRate() * rateFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;m1_rate&quot;, meter.getOneMinuteRate() * rateFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;m5_rate&quot;, meter.getFiveMinuteRate() * rateFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;mean_rate&quot;, meter.getMeanRate() * rateFactor);</b>
<b class="fc">&nbsp;            json.writeStringField(&quot;units&quot;, rateUnit);</b>
<b class="fc">&nbsp;            json.writeEndObject();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    private static class TimerSerializer extends StdSerializer&lt;Timer&gt; {</b>
&nbsp;
&nbsp;        private static final long serialVersionUID = 1L;
&nbsp;
&nbsp;        private final String rateUnit;
&nbsp;        private final double rateFactor;
&nbsp;        private final String durationUnit;
&nbsp;        private final double durationFactor;
&nbsp;        private final boolean showSamples;
&nbsp;
&nbsp;        private TimerSerializer(TimeUnit rateUnit,
&nbsp;                                TimeUnit durationUnit,
&nbsp;                                boolean showSamples) {
<b class="fc">&nbsp;            super(Timer.class);</b>
<b class="fc">&nbsp;            this.rateUnit = calculateRateUnit(rateUnit, &quot;calls&quot;);</b>
<b class="fc">&nbsp;            this.rateFactor = rateUnit.toSeconds(1);</b>
<b class="fc">&nbsp;            this.durationUnit = durationUnit.toString().toLowerCase(Locale.US);</b>
<b class="fc">&nbsp;            this.durationFactor = 1.0 / durationUnit.toNanos(1);</b>
<b class="fc">&nbsp;            this.showSamples = showSamples;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void serialize(Timer timer,
&nbsp;                              JsonGenerator json,
&nbsp;                              SerializerProvider provider) throws IOException {
<b class="fc">&nbsp;            json.writeStartObject();</b>
<b class="fc">&nbsp;            final Snapshot snapshot = timer.getSnapshot();</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;count&quot;, timer.getCount());</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;max&quot;, snapshot.getMax() * durationFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;mean&quot;, snapshot.getMean() * durationFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;min&quot;, snapshot.getMin() * durationFactor);</b>
&nbsp;
<b class="fc">&nbsp;            json.writeNumberField(&quot;p50&quot;, snapshot.getMedian() * durationFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;p75&quot;, snapshot.get75thPercentile() * durationFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;p95&quot;, snapshot.get95thPercentile() * durationFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;p98&quot;, snapshot.get98thPercentile() * durationFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;p99&quot;, snapshot.get99thPercentile() * durationFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;p999&quot;, snapshot.get999thPercentile() * durationFactor);</b>
&nbsp;
<b class="fc">&nbsp;            if (showSamples) {</b>
<b class="fc">&nbsp;                final long[] values = snapshot.getValues();</b>
<b class="fc">&nbsp;                final double[] scaledValues = new double[values.length];</b>
<b class="fc">&nbsp;                for (int i = 0; i &lt; values.length; i++) {</b>
<b class="fc">&nbsp;                    scaledValues[i] = values[i] * durationFactor;</b>
&nbsp;                }
<b class="fc">&nbsp;                json.writeObjectField(&quot;values&quot;, scaledValues);</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            json.writeNumberField(&quot;stddev&quot;, snapshot.getStdDev() * durationFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;m15_rate&quot;, timer.getFifteenMinuteRate() * rateFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;m1_rate&quot;, timer.getOneMinuteRate() * rateFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;m5_rate&quot;, timer.getFiveMinuteRate() * rateFactor);</b>
<b class="fc">&nbsp;            json.writeNumberField(&quot;mean_rate&quot;, timer.getMeanRate() * rateFactor);</b>
<b class="fc">&nbsp;            json.writeStringField(&quot;duration_units&quot;, durationUnit);</b>
<b class="fc">&nbsp;            json.writeStringField(&quot;rate_units&quot;, rateUnit);</b>
<b class="fc">&nbsp;            json.writeEndObject();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    private static class MetricRegistrySerializer extends StdSerializer&lt;MetricRegistry&gt; {</b>
&nbsp;
&nbsp;        private static final long serialVersionUID = 1L;
&nbsp;
&nbsp;        private final MetricFilter filter;
&nbsp;
&nbsp;        private MetricRegistrySerializer(MetricFilter filter) {
<b class="fc">&nbsp;            super(MetricRegistry.class);</b>
<b class="fc">&nbsp;            this.filter = filter;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void serialize(MetricRegistry registry,
&nbsp;                              JsonGenerator json,
&nbsp;                              SerializerProvider provider) throws IOException {
<b class="fc">&nbsp;            json.writeStartObject();</b>
<b class="fc">&nbsp;            json.writeStringField(&quot;version&quot;, VERSION.toString());</b>
<b class="fc">&nbsp;            json.writeObjectField(&quot;gauges&quot;, registry.getGauges(filter));</b>
<b class="fc">&nbsp;            json.writeObjectField(&quot;counters&quot;, registry.getCounters(filter));</b>
<b class="fc">&nbsp;            json.writeObjectField(&quot;histograms&quot;, registry.getHistograms(filter));</b>
<b class="fc">&nbsp;            json.writeObjectField(&quot;meters&quot;, registry.getMeters(filter));</b>
<b class="fc">&nbsp;            json.writeObjectField(&quot;timers&quot;, registry.getTimers(filter));</b>
<b class="fc">&nbsp;            json.writeEndObject();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    protected final TimeUnit rateUnit;
&nbsp;    protected final TimeUnit durationUnit;
&nbsp;    protected final boolean showSamples;
&nbsp;    protected final MetricFilter filter;
&nbsp;
&nbsp;    public MetricsModule(TimeUnit rateUnit, TimeUnit durationUnit, boolean showSamples) {
<b class="nc">&nbsp;        this(rateUnit, durationUnit, showSamples, MetricFilter.ALL);</b>
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    public MetricsModule(TimeUnit rateUnit, TimeUnit durationUnit, boolean showSamples, MetricFilter filter) {</b>
<b class="fc">&nbsp;        this.rateUnit = rateUnit;</b>
<b class="fc">&nbsp;        this.durationUnit = durationUnit;</b>
<b class="fc">&nbsp;        this.showSamples = showSamples;</b>
<b class="fc">&nbsp;        this.filter = filter;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getModuleName() {
<b class="fc">&nbsp;        return &quot;metrics&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public Version version() {
<b class="fc">&nbsp;        return VERSION;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void setupModule(SetupContext context) {
<b class="fc">&nbsp;        context.addSerializers(new SimpleSerializers(Arrays.asList(</b>
&nbsp;                new GaugeSerializer(),
&nbsp;                new CounterSerializer(),
&nbsp;                new HistogramSerializer(showSamples),
&nbsp;                new MeterSerializer(rateUnit),
&nbsp;                new TimerSerializer(rateUnit, durationUnit, showSamples),
&nbsp;                new MetricRegistrySerializer(filter)
&nbsp;        )));
&nbsp;    }
&nbsp;
&nbsp;    private static String calculateRateUnit(TimeUnit unit, String name) {
<b class="fc">&nbsp;        final String s = unit.toString().toLowerCase(Locale.US);</b>
<b class="fc">&nbsp;        return name + &#39;/&#39; + s.substring(0, s.length() - 1);</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-02-28 00:31</div>
</div>
</body>
</html>

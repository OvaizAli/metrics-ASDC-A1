


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > HealthCheck</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.codahale.metrics.health</a>
</div>

<h1>Coverage Summary for Class: HealthCheck (com.codahale.metrics.health)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">HealthCheck</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (9/9)
  </span>
</td>
</tr>
  <tr>
    <td class="name">HealthCheck$1</td>
  </tr>
  <tr>
    <td class="name">HealthCheck$MockitoMock$LDDApxy9</td>
  </tr>
  <tr>
    <td class="name">HealthCheck$MockitoMock$LDDApxy9$auxiliary$cPDb7ChG</td>
  </tr>
  <tr>
    <td class="name">HealthCheck$MockitoMock$LDDApxy9$auxiliary$xlB1E1HC</td>
  </tr>
  <tr>
    <td class="name">HealthCheck$Result</td>
<td class="coverageStat">
  <span class="percent">
    95.7%
  </span>
  <span class="absValue">
    (22/23)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    84.5%
  </span>
  <span class="absValue">
    (49/58)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">HealthCheck$ResultBuilder</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (10/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    95.2%
  </span>
  <span class="absValue">
    (20/21)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    97.2%
  </span>
  <span class="absValue">
    (35/36)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    88.6%
  </span>
  <span class="absValue">
    (78/88)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.codahale.metrics.health;
&nbsp;
&nbsp;import com.codahale.metrics.Clock;
&nbsp;
&nbsp;import java.time.Instant;
&nbsp;import java.time.ZoneId;
&nbsp;import java.time.ZonedDateTime;
&nbsp;import java.time.format.DateTimeFormatter;
&nbsp;import java.util.Collections;
&nbsp;import java.util.LinkedHashMap;
&nbsp;import java.util.Map;
&nbsp;import java.util.concurrent.TimeUnit;
&nbsp;
&nbsp;/**
&nbsp; * A health check for a component of your application.
&nbsp; */
<b class="fc">&nbsp;public abstract class HealthCheck {</b>
&nbsp;
&nbsp;    /**
&nbsp;     * The result of a {@link HealthCheck} being run. It can be healthy (with an optional message and optional details)
&nbsp;     * or unhealthy (with either an error message or a thrown exception and optional details).
&nbsp;     */
<b class="fc">&nbsp;    public static class Result {</b>
<b class="fc">&nbsp;        private static final DateTimeFormatter DATE_FORMAT_PATTERN =</b>
<b class="fc">&nbsp;                DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSXXX&quot;);</b>
&nbsp;        private static final int PRIME = 31;
&nbsp;
&nbsp;        /**
&nbsp;         * Returns a healthy {@link Result} with no additional message.
&nbsp;         *
&nbsp;         * @return a healthy {@link Result} with no additional message
&nbsp;         */
&nbsp;        public static Result healthy() {
<b class="fc">&nbsp;            return new Result(true, null, null);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns a healthy {@link Result} with an additional message.
&nbsp;         *
&nbsp;         * @param message an informative message
&nbsp;         * @return a healthy {@link Result} with an additional message
&nbsp;         */
&nbsp;        public static Result healthy(String message) {
<b class="fc">&nbsp;            return new Result(true, message, null);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns a healthy {@link Result} with a formatted message.
&nbsp;         * &lt;p&gt;
&nbsp;         * Message formatting follows the same rules as {@link String#format(String, Object...)}.
&nbsp;         *
&nbsp;         * @param message a message format\\
&nbsp;         * @param args    the arguments apply to the message format
&nbsp;         * @return a healthy {@link Result} with an additional message
&nbsp;         * @see String#format(String, Object...)
&nbsp;         */
&nbsp;        public static Result healthy(String message, Object... args) {
<b class="fc">&nbsp;            return healthy(String.format(message, args));</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns an unhealthy {@link Result} with the given message.
&nbsp;         *
&nbsp;         * @param message an informative message describing how the health check failed
&nbsp;         * @return an unhealthy {@link Result} with the given message
&nbsp;         */
&nbsp;        public static Result unhealthy(String message) {
<b class="fc">&nbsp;            return new Result(false, message, null);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns an unhealthy {@link Result} with a formatted message.
&nbsp;         * &lt;p&gt;
&nbsp;         * Message formatting follows the same rules as {@link String#format(String, Object...)}.
&nbsp;         *
&nbsp;         * @param message a message format
&nbsp;         * @param args    the arguments apply to the message format
&nbsp;         * @return an unhealthy {@link Result} with an additional message
&nbsp;         * @see String#format(String, Object...)
&nbsp;         */
&nbsp;        public static Result unhealthy(String message, Object... args) {
<b class="fc">&nbsp;            return unhealthy(String.format(message, args));</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns an unhealthy {@link Result} with the given error.
&nbsp;         *
&nbsp;         * @param error an exception thrown during the health check
&nbsp;         * @return an unhealthy {@link Result} with the given {@code error}
&nbsp;         */
&nbsp;        public static Result unhealthy(Throwable error) {
<b class="fc">&nbsp;            return new Result(false, error.getMessage(), error);</b>
&nbsp;        }
&nbsp;
&nbsp;
&nbsp;        /**
&nbsp;         * Returns a new {@link ResultBuilder}
&nbsp;         *
&nbsp;         * @return the {@link ResultBuilder}
&nbsp;         */
&nbsp;        public static ResultBuilder builder() {
<b class="fc">&nbsp;            return new ResultBuilder();</b>
&nbsp;        }
&nbsp;
&nbsp;        private final boolean healthy;
&nbsp;        private final String message;
&nbsp;        private final Throwable error;
&nbsp;        private final Map&lt;String, Object&gt; details;
&nbsp;        private final long time;
&nbsp;
&nbsp;        private long duration; // Calculated field
&nbsp;
&nbsp;        private Result(boolean isHealthy, String message, Throwable error) {
<b class="fc">&nbsp;            this(isHealthy, message, error, null, Clock.defaultClock());</b>
&nbsp;        }
&nbsp;
&nbsp;        private Result(ResultBuilder builder) {
<b class="fc">&nbsp;            this(builder.healthy, builder.message, builder.error, builder.details, builder.clock);</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        private Result(boolean isHealthy, String message, Throwable error, Map&lt;String, Object&gt; details, Clock clock) {</b>
<b class="fc">&nbsp;            this.healthy = isHealthy;</b>
<b class="fc">&nbsp;            this.message = message;</b>
<b class="fc">&nbsp;            this.error = error;</b>
<b class="fc">&nbsp;            this.details = details == null ? null : Collections.unmodifiableMap(details);</b>
<b class="fc">&nbsp;            this.time = clock.getTime();</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns {@code true} if the result indicates the component is healthy; {@code false}
&nbsp;         * otherwise.
&nbsp;         *
&nbsp;         * @return {@code true} if the result indicates the component is healthy
&nbsp;         */
&nbsp;        public boolean isHealthy() {
<b class="fc">&nbsp;            return healthy;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns any additional message for the result, or {@code null} if the result has no
&nbsp;         * message.
&nbsp;         *
&nbsp;         * @return any additional message for the result, or {@code null}
&nbsp;         */
&nbsp;        public String getMessage() {
<b class="fc">&nbsp;            return message;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns any exception for the result, or {@code null} if the result has no exception.
&nbsp;         *
&nbsp;         * @return any exception for the result, or {@code null}
&nbsp;         */
&nbsp;        public Throwable getError() {
<b class="fc">&nbsp;            return error;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns the timestamp when the result was created as a formatted String.
&nbsp;         *
&nbsp;         * @return a formatted timestamp
&nbsp;         */
&nbsp;        public String getTimestamp() {
<b class="fc">&nbsp;            Instant currentInstant = Instant.ofEpochMilli(time);</b>
<b class="fc">&nbsp;            ZonedDateTime zonedDateTime = ZonedDateTime.ofInstant(currentInstant, ZoneId.systemDefault());</b>
<b class="fc">&nbsp;            return DATE_FORMAT_PATTERN.format(zonedDateTime);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns the time when the result was created, in milliseconds since Epoch
&nbsp;         *
&nbsp;         * @return the time when the result was created
&nbsp;         */
&nbsp;        public long getTime() {
<b class="fc">&nbsp;            return time;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns the duration in milliseconds that the healthcheck took to run
&nbsp;         *
&nbsp;         * @return the duration
&nbsp;         */
&nbsp;        public long getDuration() {
<b class="fc">&nbsp;            return duration;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Sets the duration in milliseconds. This will indicate the time it took to run the individual healthcheck
&nbsp;         *
&nbsp;         * @param duration The duration in milliseconds
&nbsp;         */
&nbsp;        public void setDuration(long duration) {
<b class="fc">&nbsp;            this.duration = duration;</b>
&nbsp;        }
&nbsp;
&nbsp;        public Map&lt;String, Object&gt; getDetails() {
<b class="fc">&nbsp;            return details;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean equals(Object o) {
<b class="fc">&nbsp;            if (this == o) {</b>
<b class="fc">&nbsp;                return true;</b>
&nbsp;            }
<b class="fc">&nbsp;            if (o == null || getClass() != o.getClass()) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="fc">&nbsp;            final Result result = (Result) o;</b>
<b class="fc">&nbsp;            return healthy == result.healthy &amp;&amp;</b>
<b class="nc">&nbsp;                    !(error != null ? !error.equals(result.error) : result.error != null) &amp;&amp;</b>
<b class="fc">&nbsp;                    !(message != null ? !message.equals(result.message) : result.message != null) &amp;&amp;</b>
&nbsp;                    time == result.time;
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public int hashCode() {
<b class="nc">&nbsp;            int result = healthy ? 1 : 0;</b>
<b class="nc">&nbsp;            result = PRIME * result + (message != null ? message.hashCode() : 0);</b>
<b class="nc">&nbsp;            result = PRIME * result + (error != null ? error.hashCode() : 0);</b>
<b class="nc">&nbsp;            result = PRIME * result + (Long.hashCode(time));</b>
<b class="nc">&nbsp;            return result;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String toString() {
<b class="fc">&nbsp;            final StringBuilder builder = new StringBuilder(&quot;Result{isHealthy=&quot;);</b>
<b class="fc">&nbsp;            builder.append(healthy);</b>
<b class="fc">&nbsp;            if (message != null) {</b>
<b class="nc">&nbsp;                builder.append(&quot;, message=&quot;).append(message);</b>
&nbsp;            }
<b class="fc">&nbsp;            if (error != null) {</b>
<b class="nc">&nbsp;                builder.append(&quot;, error=&quot;).append(error);</b>
&nbsp;            }
<b class="fc">&nbsp;            builder.append(&quot;, duration=&quot;).append(duration);</b>
<b class="fc">&nbsp;            builder.append(&quot;, timestamp=&quot;).append(getTimestamp());</b>
<b class="fc">&nbsp;            if (details != null) {</b>
<b class="fc">&nbsp;                for (Map.Entry&lt;String, Object&gt; e : details.entrySet()) {</b>
<b class="fc">&nbsp;                    builder.append(&quot;, &quot;);</b>
<b class="fc">&nbsp;                    builder.append(e.getKey())</b>
<b class="fc">&nbsp;                            .append(&quot;=&quot;)</b>
<b class="fc">&nbsp;                            .append(String.valueOf(e.getValue()));</b>
<b class="fc">&nbsp;                }</b>
&nbsp;            }
<b class="fc">&nbsp;            builder.append(&#39;}&#39;);</b>
<b class="fc">&nbsp;            return builder.toString();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This a convenient builder for an {@link HealthCheck.Result}. It can be health (with optional message and detail)
&nbsp;     * or unhealthy (with optional message, error and detail)
&nbsp;     */
<b class="fc">&nbsp;    public static class ResultBuilder {</b>
&nbsp;        private boolean healthy;
&nbsp;        private String message;
&nbsp;        private Throwable error;
&nbsp;        private Map&lt;String, Object&gt; details;
&nbsp;        private Clock clock;
&nbsp;
<b class="fc">&nbsp;        protected ResultBuilder() {</b>
<b class="fc">&nbsp;            this.healthy = true;</b>
<b class="fc">&nbsp;            this.details = new LinkedHashMap&lt;&gt;();</b>
<b class="fc">&nbsp;            this.clock = Clock.defaultClock();</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Configure an healthy result
&nbsp;         *
&nbsp;         * @return this builder with healthy status
&nbsp;         */
&nbsp;        public ResultBuilder healthy() {
<b class="fc">&nbsp;            this.healthy = true;</b>
<b class="fc">&nbsp;            return this;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Configure an unhealthy result
&nbsp;         *
&nbsp;         * @return this builder with unhealthy status
&nbsp;         */
&nbsp;        public ResultBuilder unhealthy() {
<b class="fc">&nbsp;            this.healthy = false;</b>
<b class="fc">&nbsp;            return this;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Configure an unhealthy result with an {@code error}
&nbsp;         *
&nbsp;         * @param error the error
&nbsp;         * @return this builder with the given error
&nbsp;         */
&nbsp;        public ResultBuilder unhealthy(Throwable error) {
<b class="fc">&nbsp;            this.error = error;</b>
<b class="fc">&nbsp;            return this.unhealthy().withMessage(error.getMessage());</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Set an optional message
&nbsp;         *
&nbsp;         * @param message an informative message
&nbsp;         * @return this builder with the given {@code message}
&nbsp;         */
&nbsp;        public ResultBuilder withMessage(String message) {
<b class="fc">&nbsp;            this.message = message;</b>
<b class="fc">&nbsp;            return this;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Set an optional formatted message
&nbsp;         * &lt;p&gt;
&nbsp;         * Message formatting follows the same rules as {@link String#format(String, Object...)}.
&nbsp;         *
&nbsp;         * @param message a message format
&nbsp;         * @param args    the arguments apply to the message format
&nbsp;         * @return this builder with the given formatted {@code message}
&nbsp;         * @see String#format(String, Object...)
&nbsp;         */
&nbsp;        public ResultBuilder withMessage(String message, Object... args) {
<b class="fc">&nbsp;            return withMessage(String.format(message, args));</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Add an optional detail
&nbsp;         *
&nbsp;         * @param key  a key for this detail
&nbsp;         * @param data an object representing the detail data
&nbsp;         * @return this builder with the given detail added
&nbsp;         */
&nbsp;        public ResultBuilder withDetail(String key, Object data) {
<b class="fc">&nbsp;            if (this.details == null) {</b>
<b class="nc">&nbsp;                this.details = new LinkedHashMap&lt;&gt;();</b>
&nbsp;            }
<b class="fc">&nbsp;            this.details.put(key, data);</b>
<b class="fc">&nbsp;            return this;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Configure this {@link ResultBuilder} to use the given {@code clock} instead of the default clock.
&nbsp;         * If not specified, the default clock is {@link Clock#defaultClock()}.
&nbsp;         *
&nbsp;         * @param clock the {@link Clock} to use when generating the health check timestamp (useful for unit testing)
&nbsp;         * @return this builder configured to use the given {@code clock}
&nbsp;         */
&nbsp;        public ResultBuilder usingClock(Clock clock) {
<b class="fc">&nbsp;            this.clock = clock;</b>
<b class="fc">&nbsp;            return this;</b>
&nbsp;        }
&nbsp;
&nbsp;        public Result build() {
<b class="fc">&nbsp;            return new Result(this);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Perform a check of the application component.
&nbsp;     *
&nbsp;     * @return if the component is healthy, a healthy {@link Result}; otherwise, an unhealthy {@link
&nbsp;     * Result} with a descriptive error message or exception
&nbsp;     * @throws Exception if there is an unhandled error during the health check; this will result in
&nbsp;     *                   a failed health check
&nbsp;     */
&nbsp;    protected abstract Result check() throws Exception;
&nbsp;
&nbsp;    /**
&nbsp;     * Executes the health check, catching and handling any exceptions raised by {@link #check()}.
&nbsp;     *
&nbsp;     * @return if the component is healthy, a healthy {@link Result}; otherwise, an unhealthy {@link
&nbsp;     * Result} with a descriptive error message or exception
&nbsp;     */
&nbsp;    public Result execute() {
<b class="fc">&nbsp;        long start = clock().getTick();</b>
&nbsp;        Result result;
&nbsp;        try {
<b class="fc">&nbsp;            result = check();</b>
<b class="fc">&nbsp;        } catch (Exception e) {</b>
<b class="fc">&nbsp;            result = Result.unhealthy(e);</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        result.setDuration(TimeUnit.MILLISECONDS.convert(clock().getTick() - start, TimeUnit.NANOSECONDS));</b>
<b class="fc">&nbsp;        return result;</b>
&nbsp;    }
&nbsp;
&nbsp;    protected Clock clock() {
<b class="fc">&nbsp;        return Clock.defaultClock();</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-02-27 23:52</div>
</div>
</body>
</html>

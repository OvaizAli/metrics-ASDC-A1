


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > InstrumentedQueuedThreadPool</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">io.dropwizard.metrics.jetty11</a>
</div>

<h1>Coverage Summary for Class: InstrumentedQueuedThreadPool (io.dropwizard.metrics.jetty11)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">InstrumentedQueuedThreadPool</td>
<td class="coverageStat">
  <span class="percent">
    72.2%
  </span>
  <span class="absValue">
    (13/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    84.4%
  </span>
  <span class="absValue">
    (27/32)
  </span>
</td>
</tr>
  <tr>
    <td class="name">InstrumentedQueuedThreadPool$1</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (1/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (1/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">InstrumentedQueuedThreadPool$2</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (1/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (1/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">InstrumentedQueuedThreadPool$3</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (1/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    33.3%
  </span>
  <span class="absValue">
    (1/3)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    66.7%
  </span>
  <span class="absValue">
    (16/24)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    76.9%
  </span>
  <span class="absValue">
    (30/39)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package io.dropwizard.metrics.jetty11;
&nbsp;
&nbsp;import com.codahale.metrics.MetricRegistry;
&nbsp;import com.codahale.metrics.RatioGauge;
&nbsp;import org.eclipse.jetty.util.annotation.Name;
&nbsp;import org.eclipse.jetty.util.thread.QueuedThreadPool;
&nbsp;
&nbsp;import java.util.concurrent.BlockingQueue;
&nbsp;import java.util.concurrent.ThreadFactory;
&nbsp;
&nbsp;import static com.codahale.metrics.MetricRegistry.name;
&nbsp;
<b class="nc">&nbsp;public class InstrumentedQueuedThreadPool extends QueuedThreadPool {</b>
&nbsp;    private static final String NAME_UTILIZATION = &quot;utilization&quot;;
&nbsp;    private static final String NAME_UTILIZATION_MAX = &quot;utilization-max&quot;;
&nbsp;    private static final String NAME_SIZE = &quot;size&quot;;
&nbsp;    private static final String NAME_JOBS = &quot;jobs&quot;;
&nbsp;    private static final String NAME_JOBS_QUEUE_UTILIZATION = &quot;jobs-queue-utilization&quot;;
&nbsp;
&nbsp;    private final MetricRegistry metricRegistry;
&nbsp;    private String prefix;
&nbsp;
&nbsp;    public InstrumentedQueuedThreadPool(@Name(&quot;registry&quot;) MetricRegistry registry) {
<b class="fc">&nbsp;        this(registry, 200);</b>
&nbsp;    }
&nbsp;
&nbsp;    public InstrumentedQueuedThreadPool(@Name(&quot;registry&quot;) MetricRegistry registry,
&nbsp;                                        @Name(&quot;maxThreads&quot;) int maxThreads) {
<b class="fc">&nbsp;        this(registry, maxThreads, 8);</b>
&nbsp;    }
&nbsp;
&nbsp;    public InstrumentedQueuedThreadPool(@Name(&quot;registry&quot;) MetricRegistry registry,
&nbsp;                                        @Name(&quot;maxThreads&quot;) int maxThreads,
&nbsp;                                        @Name(&quot;minThreads&quot;) int minThreads) {
<b class="fc">&nbsp;        this(registry, maxThreads, minThreads, 60000);</b>
&nbsp;    }
&nbsp;
&nbsp;    public InstrumentedQueuedThreadPool(@Name(&quot;registry&quot;) MetricRegistry registry,
&nbsp;                                        @Name(&quot;maxThreads&quot;) int maxThreads,
&nbsp;                                        @Name(&quot;minThreads&quot;) int minThreads,
&nbsp;                                        @Name(&quot;queue&quot;) BlockingQueue&lt;Runnable&gt; queue) {
<b class="nc">&nbsp;        this(registry, maxThreads, minThreads, 60000, queue);</b>
&nbsp;    }
&nbsp;
&nbsp;    public InstrumentedQueuedThreadPool(@Name(&quot;registry&quot;) MetricRegistry registry,
&nbsp;                                        @Name(&quot;maxThreads&quot;) int maxThreads,
&nbsp;                                        @Name(&quot;minThreads&quot;) int minThreads,
&nbsp;                                        @Name(&quot;idleTimeout&quot;) int idleTimeout) {
<b class="fc">&nbsp;        this(registry, maxThreads, minThreads, idleTimeout, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public InstrumentedQueuedThreadPool(@Name(&quot;registry&quot;) MetricRegistry registry,
&nbsp;                                        @Name(&quot;maxThreads&quot;) int maxThreads,
&nbsp;                                        @Name(&quot;minThreads&quot;) int minThreads,
&nbsp;                                        @Name(&quot;idleTimeout&quot;) int idleTimeout,
&nbsp;                                        @Name(&quot;queue&quot;) BlockingQueue&lt;Runnable&gt; queue) {
<b class="fc">&nbsp;        this(registry, maxThreads, minThreads, idleTimeout, queue, (ThreadGroup) null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public InstrumentedQueuedThreadPool(@Name(&quot;registry&quot;) MetricRegistry registry,
&nbsp;                                        @Name(&quot;maxThreads&quot;) int maxThreads,
&nbsp;                                        @Name(&quot;minThreads&quot;) int minThreads,
&nbsp;                                        @Name(&quot;idleTimeout&quot;) int idleTimeout,
&nbsp;                                        @Name(&quot;queue&quot;) BlockingQueue&lt;Runnable&gt; queue,
&nbsp;                                        @Name(&quot;prefix&quot;) String prefix) {
<b class="nc">&nbsp;        this(registry, maxThreads, minThreads, idleTimeout, -1, queue, null, null, prefix);</b>
&nbsp;    }
&nbsp;
&nbsp;    public InstrumentedQueuedThreadPool(@Name(&quot;registry&quot;) MetricRegistry registry,
&nbsp;                                        @Name(&quot;maxThreads&quot;) int maxThreads,
&nbsp;                                        @Name(&quot;minThreads&quot;) int minThreads,
&nbsp;                                        @Name(&quot;idleTimeout&quot;) int idleTimeout,
&nbsp;                                        @Name(&quot;queue&quot;) BlockingQueue&lt;Runnable&gt; queue,
&nbsp;                                        @Name(&quot;threadFactory&quot;) ThreadFactory threadFactory) {
<b class="nc">&nbsp;        this(registry, maxThreads, minThreads, idleTimeout, -1, queue, null, threadFactory);</b>
&nbsp;    }
&nbsp;
&nbsp;    public InstrumentedQueuedThreadPool(@Name(&quot;registry&quot;) MetricRegistry registry,
&nbsp;                                        @Name(&quot;maxThreads&quot;) int maxThreads,
&nbsp;                                        @Name(&quot;minThreads&quot;) int minThreads,
&nbsp;                                        @Name(&quot;idleTimeout&quot;) int idleTimeout,
&nbsp;                                        @Name(&quot;queue&quot;) BlockingQueue&lt;Runnable&gt; queue,
&nbsp;                                        @Name(&quot;threadGroup&quot;) ThreadGroup threadGroup) {
<b class="fc">&nbsp;        this(registry, maxThreads, minThreads, idleTimeout, -1, queue, threadGroup);</b>
&nbsp;    }
&nbsp;
&nbsp;    public InstrumentedQueuedThreadPool(@Name(&quot;registry&quot;) MetricRegistry registry,
&nbsp;                                        @Name(&quot;maxThreads&quot;) int maxThreads,
&nbsp;                                        @Name(&quot;minThreads&quot;) int minThreads,
&nbsp;                                        @Name(&quot;idleTimeout&quot;) int idleTimeout,
&nbsp;                                        @Name(&quot;reservedThreads&quot;) int reservedThreads,
&nbsp;                                        @Name(&quot;queue&quot;) BlockingQueue&lt;Runnable&gt; queue,
&nbsp;                                        @Name(&quot;threadGroup&quot;) ThreadGroup threadGroup) {
<b class="fc">&nbsp;        this(registry, maxThreads, minThreads, idleTimeout, reservedThreads, queue, threadGroup, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public InstrumentedQueuedThreadPool(@Name(&quot;registry&quot;) MetricRegistry registry,
&nbsp;                                        @Name(&quot;maxThreads&quot;) int maxThreads,
&nbsp;                                        @Name(&quot;minThreads&quot;) int minThreads,
&nbsp;                                        @Name(&quot;idleTimeout&quot;) int idleTimeout,
&nbsp;                                        @Name(&quot;reservedThreads&quot;) int reservedThreads,
&nbsp;                                        @Name(&quot;queue&quot;) BlockingQueue&lt;Runnable&gt; queue,
&nbsp;                                        @Name(&quot;threadGroup&quot;) ThreadGroup threadGroup,
&nbsp;                                        @Name(&quot;threadFactory&quot;) ThreadFactory threadFactory) {
<b class="fc">&nbsp;        this(registry, maxThreads, minThreads, idleTimeout, reservedThreads, queue, threadGroup, threadFactory, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public InstrumentedQueuedThreadPool(@Name(&quot;registry&quot;) MetricRegistry registry,
&nbsp;                                        @Name(&quot;maxThreads&quot;) int maxThreads,
&nbsp;                                        @Name(&quot;minThreads&quot;) int minThreads,
&nbsp;                                        @Name(&quot;idleTimeout&quot;) int idleTimeout,
&nbsp;                                        @Name(&quot;reservedThreads&quot;) int reservedThreads,
&nbsp;                                        @Name(&quot;queue&quot;) BlockingQueue&lt;Runnable&gt; queue,
&nbsp;                                        @Name(&quot;threadGroup&quot;) ThreadGroup threadGroup,
&nbsp;                                        @Name(&quot;threadFactory&quot;) ThreadFactory threadFactory,
&nbsp;                                        @Name(&quot;prefix&quot;) String prefix) {
<b class="fc">&nbsp;        super(maxThreads, minThreads, idleTimeout, reservedThreads, queue, threadGroup, threadFactory);</b>
<b class="fc">&nbsp;        this.metricRegistry = registry;</b>
<b class="fc">&nbsp;        this.prefix = prefix;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getPrefix() {
<b class="nc">&nbsp;        return prefix;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setPrefix(String prefix) {
<b class="fc">&nbsp;        this.prefix = prefix;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    protected void doStart() throws Exception {
<b class="fc">&nbsp;        super.doStart();</b>
&nbsp;
<b class="fc">&nbsp;        final String prefix = getMetricPrefix();</b>
&nbsp;
<b class="fc">&nbsp;        metricRegistry.register(name(prefix, NAME_UTILIZATION), new RatioGauge() {</b>
&nbsp;            @Override
&nbsp;            protected Ratio getRatio() {
<b class="nc">&nbsp;                return Ratio.of(getThreads() - getIdleThreads(), getThreads());</b>
&nbsp;            }
&nbsp;        });
<b class="fc">&nbsp;        metricRegistry.register(name(prefix, NAME_UTILIZATION_MAX), new RatioGauge() {</b>
&nbsp;            @Override
&nbsp;            protected Ratio getRatio() {
<b class="nc">&nbsp;                return Ratio.of(getThreads() - getIdleThreads(), getMaxThreads());</b>
&nbsp;            }
&nbsp;        });
<b class="fc">&nbsp;        metricRegistry.registerGauge(name(prefix, NAME_SIZE), this::getThreads);</b>
&nbsp;        // This assumes the QueuedThreadPool is using a BlockingArrayQueue or
&nbsp;        // ArrayBlockingQueue for its queue, and is therefore a constant-time operation.
<b class="fc">&nbsp;        metricRegistry.registerGauge(name(prefix, NAME_JOBS), () -&gt; getQueue().size());</b>
<b class="fc">&nbsp;        metricRegistry.register(name(prefix, NAME_JOBS_QUEUE_UTILIZATION), new RatioGauge() {</b>
&nbsp;            @Override
&nbsp;            protected Ratio getRatio() {
<b class="nc">&nbsp;                BlockingQueue&lt;Runnable&gt; queue = getQueue();</b>
<b class="nc">&nbsp;                return Ratio.of(queue.size(), queue.size() + queue.remainingCapacity());</b>
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    protected void doStop() throws Exception {
<b class="fc">&nbsp;        final String prefix = getMetricPrefix();</b>
&nbsp;
<b class="fc">&nbsp;        metricRegistry.remove(name(prefix, NAME_UTILIZATION));</b>
<b class="fc">&nbsp;        metricRegistry.remove(name(prefix, NAME_UTILIZATION_MAX));</b>
<b class="fc">&nbsp;        metricRegistry.remove(name(prefix, NAME_SIZE));</b>
<b class="fc">&nbsp;        metricRegistry.remove(name(prefix, NAME_JOBS));</b>
<b class="fc">&nbsp;        metricRegistry.remove(name(prefix, NAME_JOBS_QUEUE_UTILIZATION));</b>
&nbsp;
<b class="fc">&nbsp;        super.doStop();</b>
&nbsp;    }
&nbsp;
&nbsp;    private String getMetricPrefix() {
<b class="fc">&nbsp;        return this.prefix == null ? name(QueuedThreadPool.class, getName()) : name(this.prefix, getName());</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-02-27 23:52</div>
</div>
</body>
</html>

<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ConsoleReporter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">All in metrics-log4j2 Coverage Results</a> &gt; <a href="index.source.html" class="el_package">com.codahale.metrics</a> &gt; <span class="el_source">ConsoleReporter.java</span></div><h1>ConsoleReporter.java</h1><pre class="source lang-java linenums">package com.codahale.metrics;

import java.io.PrintStream;
import java.text.DateFormat;
import java.util.Collections;
import java.util.Date;
import java.util.Locale;
import java.util.Map;
import java.util.Set;
import java.util.SortedMap;
import java.util.TimeZone;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

/**
 * A reporter which outputs measurements to a {@link PrintStream}, like {@code System.out}.
 */
public class ConsoleReporter extends ScheduledReporter {
    /**
     * Returns a new {@link Builder} for {@link ConsoleReporter}.
     *
     * @param registry the registry to report
     * @return a {@link Builder} instance for a {@link ConsoleReporter}
     */
    public static Builder forRegistry(MetricRegistry registry) {
<span class="nc" id="L26">        return new Builder(registry);</span>
    }

    /**
     * A builder for {@link ConsoleReporter} instances. Defaults to using the default locale and
     * time zone, writing to {@code System.out}, converting rates to events/second, converting
     * durations to milliseconds, and not filtering metrics.
     */
    public static class Builder {
        private final MetricRegistry registry;
        private PrintStream output;
        private Locale locale;
        private Clock clock;
        private TimeZone timeZone;
        private TimeUnit rateUnit;
        private TimeUnit durationUnit;
        private MetricFilter filter;
        private ScheduledExecutorService executor;
        private boolean shutdownExecutorOnStop;
        private Set&lt;MetricAttribute&gt; disabledMetricAttributes;

<span class="nc" id="L47">        private Builder(MetricRegistry registry) {</span>
<span class="nc" id="L48">            this.registry = registry;</span>
<span class="nc" id="L49">            this.output = System.out;</span>
<span class="nc" id="L50">            this.locale = Locale.getDefault();</span>
<span class="nc" id="L51">            this.clock = Clock.defaultClock();</span>
<span class="nc" id="L52">            this.timeZone = TimeZone.getDefault();</span>
<span class="nc" id="L53">            this.rateUnit = TimeUnit.SECONDS;</span>
<span class="nc" id="L54">            this.durationUnit = TimeUnit.MILLISECONDS;</span>
<span class="nc" id="L55">            this.filter = MetricFilter.ALL;</span>
<span class="nc" id="L56">            this.executor = null;</span>
<span class="nc" id="L57">            this.shutdownExecutorOnStop = true;</span>
<span class="nc" id="L58">            disabledMetricAttributes = Collections.emptySet();</span>
<span class="nc" id="L59">        }</span>

        /**
         * Specifies whether or not, the executor (used for reporting) will be stopped with same time with reporter.
         * Default value is true.
         * Setting this parameter to false, has the sense in combining with providing external managed executor via {@link #scheduleOn(ScheduledExecutorService)}.
         *
         * @param shutdownExecutorOnStop if true, then executor will be stopped in same time with this reporter
         * @return {@code this}
         */
        public Builder shutdownExecutorOnStop(boolean shutdownExecutorOnStop) {
<span class="nc" id="L70">            this.shutdownExecutorOnStop = shutdownExecutorOnStop;</span>
<span class="nc" id="L71">            return this;</span>
        }

        /**
         * Specifies the executor to use while scheduling reporting of metrics.
         * Default value is null.
         * Null value leads to executor will be auto created on start.
         *
         * @param executor the executor to use while scheduling reporting of metrics.
         * @return {@code this}
         */
        public Builder scheduleOn(ScheduledExecutorService executor) {
<span class="nc" id="L83">            this.executor = executor;</span>
<span class="nc" id="L84">            return this;</span>
        }

        /**
         * Write to the given {@link PrintStream}.
         *
         * @param output a {@link PrintStream} instance.
         * @return {@code this}
         */
        public Builder outputTo(PrintStream output) {
<span class="nc" id="L94">            this.output = output;</span>
<span class="nc" id="L95">            return this;</span>
        }

        /**
         * Format numbers for the given {@link Locale}.
         *
         * @param locale a {@link Locale}
         * @return {@code this}
         */
        public Builder formattedFor(Locale locale) {
<span class="nc" id="L105">            this.locale = locale;</span>
<span class="nc" id="L106">            return this;</span>
        }

        /**
         * Use the given {@link Clock} instance for the time.
         *
         * @param clock a {@link Clock} instance
         * @return {@code this}
         */
        public Builder withClock(Clock clock) {
<span class="nc" id="L116">            this.clock = clock;</span>
<span class="nc" id="L117">            return this;</span>
        }

        /**
         * Use the given {@link TimeZone} for the time.
         *
         * @param timeZone a {@link TimeZone}
         * @return {@code this}
         */
        public Builder formattedFor(TimeZone timeZone) {
<span class="nc" id="L127">            this.timeZone = timeZone;</span>
<span class="nc" id="L128">            return this;</span>
        }

        /**
         * Convert rates to the given time unit.
         *
         * @param rateUnit a unit of time
         * @return {@code this}
         */
        public Builder convertRatesTo(TimeUnit rateUnit) {
<span class="nc" id="L138">            this.rateUnit = rateUnit;</span>
<span class="nc" id="L139">            return this;</span>
        }

        /**
         * Convert durations to the given time unit.
         *
         * @param durationUnit a unit of time
         * @return {@code this}
         */
        public Builder convertDurationsTo(TimeUnit durationUnit) {
<span class="nc" id="L149">            this.durationUnit = durationUnit;</span>
<span class="nc" id="L150">            return this;</span>
        }

        /**
         * Only report metrics which match the given filter.
         *
         * @param filter a {@link MetricFilter}
         * @return {@code this}
         */
        public Builder filter(MetricFilter filter) {
<span class="nc" id="L160">            this.filter = filter;</span>
<span class="nc" id="L161">            return this;</span>
        }

        /**
         * Don't report the passed metric attributes for all metrics (e.g. &quot;p999&quot;, &quot;stddev&quot; or &quot;m15&quot;).
         * See {@link MetricAttribute}.
         *
         * @param disabledMetricAttributes a {@link MetricFilter}
         * @return {@code this}
         */
        public Builder disabledMetricAttributes(Set&lt;MetricAttribute&gt; disabledMetricAttributes) {
<span class="nc" id="L172">            this.disabledMetricAttributes = disabledMetricAttributes;</span>
<span class="nc" id="L173">            return this;</span>
        }

        /**
         * Builds a {@link ConsoleReporter} with the given properties.
         *
         * @return a {@link ConsoleReporter}
         */
        public ConsoleReporter build() {
<span class="nc" id="L182">            return new ConsoleReporter(registry,</span>
                    output,
                    locale,
                    clock,
                    timeZone,
                    rateUnit,
                    durationUnit,
                    filter,
                    executor,
                    shutdownExecutorOnStop,
                    disabledMetricAttributes);
        }
    }

    private static final int CONSOLE_WIDTH = 80;

    private final PrintStream output;
    private final Locale locale;
    private final Clock clock;
    private final DateFormat dateFormat;

    private ConsoleReporter(MetricRegistry registry,
                            PrintStream output,
                            Locale locale,
                            Clock clock,
                            TimeZone timeZone,
                            TimeUnit rateUnit,
                            TimeUnit durationUnit,
                            MetricFilter filter,
                            ScheduledExecutorService executor,
                            boolean shutdownExecutorOnStop,
                            Set&lt;MetricAttribute&gt; disabledMetricAttributes) {
<span class="nc" id="L214">        super(registry, &quot;console-reporter&quot;, filter, rateUnit, durationUnit, executor, shutdownExecutorOnStop, disabledMetricAttributes);</span>
<span class="nc" id="L215">        this.output = output;</span>
<span class="nc" id="L216">        this.locale = locale;</span>
<span class="nc" id="L217">        this.clock = clock;</span>
<span class="nc" id="L218">        this.dateFormat = DateFormat.getDateTimeInstance(DateFormat.SHORT,</span>
                DateFormat.MEDIUM,
                locale);
<span class="nc" id="L221">        dateFormat.setTimeZone(timeZone);</span>
<span class="nc" id="L222">    }</span>

    @Override
    @SuppressWarnings(&quot;rawtypes&quot;)
    public void report(SortedMap&lt;String, Gauge&gt; gauges,
                       SortedMap&lt;String, Counter&gt; counters,
                       SortedMap&lt;String, Histogram&gt; histograms,
                       SortedMap&lt;String, Meter&gt; meters,
                       SortedMap&lt;String, Timer&gt; timers) {
<span class="nc" id="L231">        final String dateTime = dateFormat.format(new Date(clock.getTime()));</span>
<span class="nc" id="L232">        printWithBanner(dateTime, '=');</span>
<span class="nc" id="L233">        output.println();</span>

<span class="nc bnc" id="L235" title="All 2 branches missed.">        if (!gauges.isEmpty()) {</span>
<span class="nc" id="L236">            printWithBanner(&quot;-- Gauges&quot;, '-');</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">            for (Map.Entry&lt;String, Gauge&gt; entry : gauges.entrySet()) {</span>
<span class="nc" id="L238">                output.println(entry.getKey());</span>
<span class="nc" id="L239">                printGauge(entry.getValue());</span>
<span class="nc" id="L240">            }</span>
<span class="nc" id="L241">            output.println();</span>
        }

<span class="nc bnc" id="L244" title="All 2 branches missed.">        if (!counters.isEmpty()) {</span>
<span class="nc" id="L245">            printWithBanner(&quot;-- Counters&quot;, '-');</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">            for (Map.Entry&lt;String, Counter&gt; entry : counters.entrySet()) {</span>
<span class="nc" id="L247">                output.println(entry.getKey());</span>
<span class="nc" id="L248">                printCounter(entry);</span>
<span class="nc" id="L249">            }</span>
<span class="nc" id="L250">            output.println();</span>
        }

<span class="nc bnc" id="L253" title="All 2 branches missed.">        if (!histograms.isEmpty()) {</span>
<span class="nc" id="L254">            printWithBanner(&quot;-- Histograms&quot;, '-');</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">            for (Map.Entry&lt;String, Histogram&gt; entry : histograms.entrySet()) {</span>
<span class="nc" id="L256">                output.println(entry.getKey());</span>
<span class="nc" id="L257">                printHistogram(entry.getValue());</span>
<span class="nc" id="L258">            }</span>
<span class="nc" id="L259">            output.println();</span>
        }

<span class="nc bnc" id="L262" title="All 2 branches missed.">        if (!meters.isEmpty()) {</span>
<span class="nc" id="L263">            printWithBanner(&quot;-- Meters&quot;, '-');</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">            for (Map.Entry&lt;String, Meter&gt; entry : meters.entrySet()) {</span>
<span class="nc" id="L265">                output.println(entry.getKey());</span>
<span class="nc" id="L266">                printMeter(entry.getValue());</span>
<span class="nc" id="L267">            }</span>
<span class="nc" id="L268">            output.println();</span>
        }

<span class="nc bnc" id="L271" title="All 2 branches missed.">        if (!timers.isEmpty()) {</span>
<span class="nc" id="L272">            printWithBanner(&quot;-- Timers&quot;, '-');</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">            for (Map.Entry&lt;String, Timer&gt; entry : timers.entrySet()) {</span>
<span class="nc" id="L274">                output.println(entry.getKey());</span>
<span class="nc" id="L275">                printTimer(entry.getValue());</span>
<span class="nc" id="L276">            }</span>
<span class="nc" id="L277">            output.println();</span>
        }

<span class="nc" id="L280">        output.println();</span>
<span class="nc" id="L281">        output.flush();</span>
<span class="nc" id="L282">    }</span>

    private void printMeter(Meter meter) {
<span class="nc" id="L285">        printIfEnabled(MetricAttribute.COUNT, String.format(locale, &quot;             count = %d&quot;, meter.getCount()));</span>
<span class="nc" id="L286">        printIfEnabled(MetricAttribute.MEAN_RATE, String.format(locale, &quot;         mean rate = %2.2f events/%s&quot;, convertRate(meter.getMeanRate()), getRateUnit()));</span>
<span class="nc" id="L287">        printIfEnabled(MetricAttribute.M1_RATE, String.format(locale, &quot;     1-minute rate = %2.2f events/%s&quot;, convertRate(meter.getOneMinuteRate()), getRateUnit()));</span>
<span class="nc" id="L288">        printIfEnabled(MetricAttribute.M5_RATE, String.format(locale, &quot;     5-minute rate = %2.2f events/%s&quot;, convertRate(meter.getFiveMinuteRate()), getRateUnit()));</span>
<span class="nc" id="L289">        printIfEnabled(MetricAttribute.M15_RATE, String.format(locale, &quot;    15-minute rate = %2.2f events/%s&quot;, convertRate(meter.getFifteenMinuteRate()), getRateUnit()));</span>
<span class="nc" id="L290">    }</span>

    private void printCounter(Map.Entry&lt;String, Counter&gt; entry) {
<span class="nc" id="L293">        output.printf(locale, &quot;             count = %d%n&quot;, entry.getValue().getCount());</span>
<span class="nc" id="L294">    }</span>

    private void printGauge(Gauge&lt;?&gt; gauge) {
<span class="nc" id="L297">        output.printf(locale, &quot;             value = %s%n&quot;, gauge.getValue());</span>
<span class="nc" id="L298">    }</span>

    private void printHistogram(Histogram histogram) {
<span class="nc" id="L301">        printIfEnabled(MetricAttribute.COUNT, String.format(locale, &quot;             count = %d&quot;, histogram.getCount()));</span>
<span class="nc" id="L302">        Snapshot snapshot = histogram.getSnapshot();</span>
<span class="nc" id="L303">        printIfEnabled(MetricAttribute.MIN, String.format(locale, &quot;               min = %d&quot;, snapshot.getMin()));</span>
<span class="nc" id="L304">        printIfEnabled(MetricAttribute.MAX, String.format(locale, &quot;               max = %d&quot;, snapshot.getMax()));</span>
<span class="nc" id="L305">        printIfEnabled(MetricAttribute.MEAN, String.format(locale, &quot;              mean = %2.2f&quot;, snapshot.getMean()));</span>
<span class="nc" id="L306">        printIfEnabled(MetricAttribute.STDDEV, String.format(locale, &quot;            stddev = %2.2f&quot;, snapshot.getStdDev()));</span>
<span class="nc" id="L307">        printIfEnabled(MetricAttribute.P50, String.format(locale, &quot;            median = %2.2f&quot;, snapshot.getMedian()));</span>
<span class="nc" id="L308">        printIfEnabled(MetricAttribute.P75, String.format(locale, &quot;              75%% &lt;= %2.2f&quot;, snapshot.get75thPercentile()));</span>
<span class="nc" id="L309">        printIfEnabled(MetricAttribute.P95, String.format(locale, &quot;              95%% &lt;= %2.2f&quot;, snapshot.get95thPercentile()));</span>
<span class="nc" id="L310">        printIfEnabled(MetricAttribute.P98, String.format(locale, &quot;              98%% &lt;= %2.2f&quot;, snapshot.get98thPercentile()));</span>
<span class="nc" id="L311">        printIfEnabled(MetricAttribute.P99, String.format(locale, &quot;              99%% &lt;= %2.2f&quot;, snapshot.get99thPercentile()));</span>
<span class="nc" id="L312">        printIfEnabled(MetricAttribute.P999, String.format(locale, &quot;            99.9%% &lt;= %2.2f&quot;, snapshot.get999thPercentile()));</span>
<span class="nc" id="L313">    }</span>

    private void printTimer(Timer timer) {
<span class="nc" id="L316">        final Snapshot snapshot = timer.getSnapshot();</span>
<span class="nc" id="L317">        printIfEnabled(MetricAttribute.COUNT, String.format(locale, &quot;             count = %d&quot;, timer.getCount()));</span>
<span class="nc" id="L318">        printIfEnabled(MetricAttribute.MEAN_RATE, String.format(locale, &quot;         mean rate = %2.2f calls/%s&quot;, convertRate(timer.getMeanRate()), getRateUnit()));</span>
<span class="nc" id="L319">        printIfEnabled(MetricAttribute.M1_RATE, String.format(locale, &quot;     1-minute rate = %2.2f calls/%s&quot;, convertRate(timer.getOneMinuteRate()), getRateUnit()));</span>
<span class="nc" id="L320">        printIfEnabled(MetricAttribute.M5_RATE, String.format(locale, &quot;     5-minute rate = %2.2f calls/%s&quot;, convertRate(timer.getFiveMinuteRate()), getRateUnit()));</span>
<span class="nc" id="L321">        printIfEnabled(MetricAttribute.M15_RATE, String.format(locale, &quot;    15-minute rate = %2.2f calls/%s&quot;, convertRate(timer.getFifteenMinuteRate()), getRateUnit()));</span>

<span class="nc" id="L323">        printIfEnabled(MetricAttribute.MIN, String.format(locale, &quot;               min = %2.2f %s&quot;, convertDuration(snapshot.getMin()), getDurationUnit()));</span>
<span class="nc" id="L324">        printIfEnabled(MetricAttribute.MAX, String.format(locale, &quot;               max = %2.2f %s&quot;, convertDuration(snapshot.getMax()), getDurationUnit()));</span>
<span class="nc" id="L325">        printIfEnabled(MetricAttribute.MEAN, String.format(locale, &quot;              mean = %2.2f %s&quot;, convertDuration(snapshot.getMean()), getDurationUnit()));</span>
<span class="nc" id="L326">        printIfEnabled(MetricAttribute.STDDEV, String.format(locale, &quot;            stddev = %2.2f %s&quot;, convertDuration(snapshot.getStdDev()), getDurationUnit()));</span>
<span class="nc" id="L327">        printIfEnabled(MetricAttribute.P50, String.format(locale, &quot;            median = %2.2f %s&quot;, convertDuration(snapshot.getMedian()), getDurationUnit()));</span>
<span class="nc" id="L328">        printIfEnabled(MetricAttribute.P75, String.format(locale, &quot;              75%% &lt;= %2.2f %s&quot;, convertDuration(snapshot.get75thPercentile()), getDurationUnit()));</span>
<span class="nc" id="L329">        printIfEnabled(MetricAttribute.P95, String.format(locale, &quot;              95%% &lt;= %2.2f %s&quot;, convertDuration(snapshot.get95thPercentile()), getDurationUnit()));</span>
<span class="nc" id="L330">        printIfEnabled(MetricAttribute.P98, String.format(locale, &quot;              98%% &lt;= %2.2f %s&quot;, convertDuration(snapshot.get98thPercentile()), getDurationUnit()));</span>
<span class="nc" id="L331">        printIfEnabled(MetricAttribute.P99, String.format(locale, &quot;              99%% &lt;= %2.2f %s&quot;, convertDuration(snapshot.get99thPercentile()), getDurationUnit()));</span>
<span class="nc" id="L332">        printIfEnabled(MetricAttribute.P999, String.format(locale, &quot;            99.9%% &lt;= %2.2f %s&quot;, convertDuration(snapshot.get999thPercentile()), getDurationUnit()));</span>
<span class="nc" id="L333">    }</span>

    private void printWithBanner(String s, char c) {
<span class="nc" id="L336">        output.print(s);</span>
<span class="nc" id="L337">        output.print(' ');</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">        for (int i = 0; i &lt; (CONSOLE_WIDTH - s.length() - 1); i++) {</span>
<span class="nc" id="L339">            output.print(c);</span>
        }
<span class="nc" id="L341">        output.println();</span>
<span class="nc" id="L342">    }</span>

    /**
     * Print only if the attribute is enabled
     *
     * @param type   Metric attribute
     * @param status Status to be logged
     */
    private void printIfEnabled(MetricAttribute type, String status) {
<span class="nc bnc" id="L351" title="All 2 branches missed.">        if (getDisabledMetricAttributes().contains(type)) {</span>
<span class="nc" id="L352">            return;</span>
        }

<span class="nc" id="L355">        output.println(status);</span>
<span class="nc" id="L356">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>
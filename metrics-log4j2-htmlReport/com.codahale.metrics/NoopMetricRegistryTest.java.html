<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NoopMetricRegistryTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">All in metrics-log4j2 Coverage Results</a> &gt; <a href="index.source.html" class="el_package">com.codahale.metrics</a> &gt; <span class="el_source">NoopMetricRegistryTest.java</span></div><h1>NoopMetricRegistryTest.java</h1><pre class="source lang-java linenums">package com.codahale.metrics;

import org.junit.Before;
import org.junit.Test;

import java.util.HashMap;
import java.util.Map;
import java.util.Set;

import static org.assertj.core.api.Assertions.assertThat;
import static org.assertj.core.api.Assertions.assertThatNullPointerException;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.never;
import static org.mockito.Mockito.verify;

<span class="nc" id="L16">public class NoopMetricRegistryTest {</span>
<span class="nc" id="L17">    private final MetricRegistryListener listener = mock(MetricRegistryListener.class);</span>
<span class="nc" id="L18">    private final NoopMetricRegistry registry = new NoopMetricRegistry();</span>
<span class="nc" id="L19">    private final Gauge&lt;String&gt; gauge = () -&gt; &quot;&quot;;</span>
<span class="nc" id="L20">    private final Counter counter = mock(Counter.class);</span>
<span class="nc" id="L21">    private final Histogram histogram = mock(Histogram.class);</span>
<span class="nc" id="L22">    private final Meter meter = mock(Meter.class);</span>
<span class="nc" id="L23">    private final Timer timer = mock(Timer.class);</span>

    @Before
    public void setUp() {
<span class="nc" id="L27">        registry.addListener(listener);</span>
<span class="nc" id="L28">    }</span>

    @Test
    public void registeringAGaugeTriggersNoNotification() {
<span class="nc" id="L32">        assertThat(registry.register(&quot;thing&quot;, gauge)).isEqualTo(gauge);</span>

<span class="nc" id="L34">        verify(listener, never()).onGaugeAdded(&quot;thing&quot;, gauge);</span>
<span class="nc" id="L35">    }</span>

    @Test
    public void removingAGaugeTriggersNoNotification() {
<span class="nc" id="L39">        registry.register(&quot;thing&quot;, gauge);</span>

<span class="nc" id="L41">        assertThat(registry.remove(&quot;thing&quot;)).isFalse();</span>

<span class="nc" id="L43">        verify(listener, never()).onGaugeRemoved(&quot;thing&quot;);</span>
<span class="nc" id="L44">    }</span>

    @Test
    public void registeringACounterTriggersNoNotification() {
<span class="nc" id="L48">        assertThat(registry.register(&quot;thing&quot;, counter)).isEqualTo(counter);</span>

<span class="nc" id="L50">        verify(listener, never()).onCounterAdded(&quot;thing&quot;, counter);</span>
<span class="nc" id="L51">    }</span>

    @Test
    public void accessingACounterRegistersAndReusesTheCounter() {
<span class="nc" id="L55">        final Counter counter1 = registry.counter(&quot;thing&quot;);</span>
<span class="nc" id="L56">        final Counter counter2 = registry.counter(&quot;thing&quot;);</span>

<span class="nc" id="L58">        assertThat(counter1).isExactlyInstanceOf(NoopMetricRegistry.NoopCounter.class);</span>
<span class="nc" id="L59">        assertThat(counter2).isExactlyInstanceOf(NoopMetricRegistry.NoopCounter.class);</span>
<span class="nc" id="L60">        assertThat(counter1).isSameAs(counter2);</span>

<span class="nc" id="L62">        verify(listener, never()).onCounterAdded(&quot;thing&quot;, counter1);</span>
<span class="nc" id="L63">    }</span>

    @Test
    public void accessingACustomCounterRegistersAndReusesTheCounter() {
<span class="nc" id="L67">        final MetricRegistry.MetricSupplier&lt;Counter&gt; supplier = () -&gt; counter;</span>
<span class="nc" id="L68">        final Counter counter1 = registry.counter(&quot;thing&quot;, supplier);</span>
<span class="nc" id="L69">        final Counter counter2 = registry.counter(&quot;thing&quot;, supplier);</span>

<span class="nc" id="L71">        assertThat(counter1).isExactlyInstanceOf(NoopMetricRegistry.NoopCounter.class);</span>
<span class="nc" id="L72">        assertThat(counter2).isExactlyInstanceOf(NoopMetricRegistry.NoopCounter.class);</span>
<span class="nc" id="L73">        assertThat(counter1).isSameAs(counter2);</span>

<span class="nc" id="L75">        verify(listener, never()).onCounterAdded(&quot;thing&quot;, counter1);</span>
<span class="nc" id="L76">    }</span>


    @Test
    public void removingACounterTriggersNoNotification() {
<span class="nc" id="L81">        registry.register(&quot;thing&quot;, counter);</span>

<span class="nc" id="L83">        assertThat(registry.remove(&quot;thing&quot;)).isFalse();</span>

<span class="nc" id="L85">        verify(listener, never()).onCounterRemoved(&quot;thing&quot;);</span>
<span class="nc" id="L86">    }</span>

    @Test
    public void registeringAHistogramTriggersNoNotification() {
<span class="nc" id="L90">        assertThat(registry.register(&quot;thing&quot;, histogram)).isEqualTo(histogram);</span>

<span class="nc" id="L92">        verify(listener, never()).onHistogramAdded(&quot;thing&quot;, histogram);</span>
<span class="nc" id="L93">    }</span>

    @Test
    public void accessingAHistogramRegistersAndReusesIt() {
<span class="nc" id="L97">        final Histogram histogram1 = registry.histogram(&quot;thing&quot;);</span>
<span class="nc" id="L98">        final Histogram histogram2 = registry.histogram(&quot;thing&quot;);</span>

<span class="nc" id="L100">        assertThat(histogram1).isExactlyInstanceOf(NoopMetricRegistry.NoopHistogram.class);</span>
<span class="nc" id="L101">        assertThat(histogram2).isExactlyInstanceOf(NoopMetricRegistry.NoopHistogram.class);</span>
<span class="nc" id="L102">        assertThat(histogram1).isSameAs(histogram2);</span>

<span class="nc" id="L104">        verify(listener, never()).onHistogramAdded(&quot;thing&quot;, histogram1);</span>
<span class="nc" id="L105">    }</span>

    @Test
    public void accessingACustomHistogramRegistersAndReusesIt() {
<span class="nc" id="L109">        final MetricRegistry.MetricSupplier&lt;Histogram&gt; supplier = () -&gt; histogram;</span>
<span class="nc" id="L110">        final Histogram histogram1 = registry.histogram(&quot;thing&quot;, supplier);</span>
<span class="nc" id="L111">        final Histogram histogram2 = registry.histogram(&quot;thing&quot;, supplier);</span>

<span class="nc" id="L113">        assertThat(histogram1).isExactlyInstanceOf(NoopMetricRegistry.NoopHistogram.class);</span>
<span class="nc" id="L114">        assertThat(histogram2).isExactlyInstanceOf(NoopMetricRegistry.NoopHistogram.class);</span>
<span class="nc" id="L115">        assertThat(histogram1).isSameAs(histogram2);</span>

<span class="nc" id="L117">        verify(listener, never()).onHistogramAdded(&quot;thing&quot;, histogram1);</span>
<span class="nc" id="L118">    }</span>

    @Test
    public void removingAHistogramTriggersNoNotification() {
<span class="nc" id="L122">        registry.register(&quot;thing&quot;, histogram);</span>

<span class="nc" id="L124">        assertThat(registry.remove(&quot;thing&quot;)).isFalse();</span>

<span class="nc" id="L126">        verify(listener, never()).onHistogramRemoved(&quot;thing&quot;);</span>
<span class="nc" id="L127">    }</span>

    @Test
    public void registeringAMeterTriggersNoNotification() {
<span class="nc" id="L131">        assertThat(registry.register(&quot;thing&quot;, meter)).isEqualTo(meter);</span>

<span class="nc" id="L133">        verify(listener, never()).onMeterAdded(&quot;thing&quot;, meter);</span>
<span class="nc" id="L134">    }</span>

    @Test
    public void accessingAMeterRegistersAndReusesIt() {
<span class="nc" id="L138">        final Meter meter1 = registry.meter(&quot;thing&quot;);</span>
<span class="nc" id="L139">        final Meter meter2 = registry.meter(&quot;thing&quot;);</span>

<span class="nc" id="L141">        assertThat(meter1).isExactlyInstanceOf(NoopMetricRegistry.NoopMeter.class);</span>
<span class="nc" id="L142">        assertThat(meter2).isExactlyInstanceOf(NoopMetricRegistry.NoopMeter.class);</span>
<span class="nc" id="L143">        assertThat(meter1).isSameAs(meter2);</span>

<span class="nc" id="L145">        verify(listener, never()).onMeterAdded(&quot;thing&quot;, meter1);</span>
<span class="nc" id="L146">    }</span>

    @Test
    public void accessingACustomMeterRegistersAndReusesIt() {
<span class="nc" id="L150">        final MetricRegistry.MetricSupplier&lt;Meter&gt; supplier = () -&gt; meter;</span>
<span class="nc" id="L151">        final Meter meter1 = registry.meter(&quot;thing&quot;, supplier);</span>
<span class="nc" id="L152">        final Meter meter2 = registry.meter(&quot;thing&quot;, supplier);</span>

<span class="nc" id="L154">        assertThat(meter1).isExactlyInstanceOf(NoopMetricRegistry.NoopMeter.class);</span>
<span class="nc" id="L155">        assertThat(meter2).isExactlyInstanceOf(NoopMetricRegistry.NoopMeter.class);</span>
<span class="nc" id="L156">        assertThat(meter1).isSameAs(meter2);</span>

<span class="nc" id="L158">        verify(listener, never()).onMeterAdded(&quot;thing&quot;, meter1);</span>
<span class="nc" id="L159">    }</span>

    @Test
    public void removingAMeterTriggersNoNotification() {
<span class="nc" id="L163">        registry.register(&quot;thing&quot;, meter);</span>

<span class="nc" id="L165">        assertThat(registry.remove(&quot;thing&quot;)).isFalse();</span>

<span class="nc" id="L167">        verify(listener, never()).onMeterRemoved(&quot;thing&quot;);</span>
<span class="nc" id="L168">    }</span>

    @Test
    public void registeringATimerTriggersNoNotification() {
<span class="nc" id="L172">        assertThat(registry.register(&quot;thing&quot;, timer)).isEqualTo(timer);</span>

<span class="nc" id="L174">        verify(listener, never()).onTimerAdded(&quot;thing&quot;, timer);</span>
<span class="nc" id="L175">    }</span>

    @Test
    public void accessingATimerRegistersAndReusesIt() {
<span class="nc" id="L179">        final Timer timer1 = registry.timer(&quot;thing&quot;);</span>
<span class="nc" id="L180">        final Timer timer2 = registry.timer(&quot;thing&quot;);</span>

<span class="nc" id="L182">        assertThat(timer1).isExactlyInstanceOf(NoopMetricRegistry.NoopTimer.class);</span>
<span class="nc" id="L183">        assertThat(timer2).isExactlyInstanceOf(NoopMetricRegistry.NoopTimer.class);</span>
<span class="nc" id="L184">        assertThat(timer1).isSameAs(timer2);</span>

<span class="nc" id="L186">        verify(listener, never()).onTimerAdded(&quot;thing&quot;, timer1);</span>
<span class="nc" id="L187">    }</span>

    @Test
    public void accessingACustomTimerRegistersAndReusesIt() {
<span class="nc" id="L191">        final MetricRegistry.MetricSupplier&lt;Timer&gt; supplier = () -&gt; timer;</span>
<span class="nc" id="L192">        final Timer timer1 = registry.timer(&quot;thing&quot;, supplier);</span>
<span class="nc" id="L193">        final Timer timer2 = registry.timer(&quot;thing&quot;, supplier);</span>

<span class="nc" id="L195">        assertThat(timer1).isExactlyInstanceOf(NoopMetricRegistry.NoopTimer.class);</span>
<span class="nc" id="L196">        assertThat(timer2).isExactlyInstanceOf(NoopMetricRegistry.NoopTimer.class);</span>
<span class="nc" id="L197">        assertThat(timer1).isSameAs(timer2);</span>

<span class="nc" id="L199">        verify(listener, never()).onTimerAdded(&quot;thing&quot;, timer1);</span>
<span class="nc" id="L200">    }</span>


    @Test
    public void removingATimerTriggersNoNotification() {
<span class="nc" id="L205">        registry.register(&quot;thing&quot;, timer);</span>

<span class="nc" id="L207">        assertThat(registry.remove(&quot;thing&quot;)).isFalse();</span>

<span class="nc" id="L209">        verify(listener, never()).onTimerRemoved(&quot;thing&quot;);</span>
<span class="nc" id="L210">    }</span>

    @Test
    public void accessingAGaugeRegistersAndReusesIt() {
<span class="nc" id="L214">        final Gauge&lt;Void&gt; gauge1 = registry.gauge(&quot;thing&quot;);</span>
<span class="nc" id="L215">        final Gauge&lt;Void&gt; gauge2 = registry.gauge(&quot;thing&quot;);</span>

<span class="nc" id="L217">        assertThat(gauge1).isExactlyInstanceOf(NoopMetricRegistry.NoopGauge.class);</span>
<span class="nc" id="L218">        assertThat(gauge2).isExactlyInstanceOf(NoopMetricRegistry.NoopGauge.class);</span>
<span class="nc" id="L219">        assertThat(gauge1).isSameAs(gauge2);</span>

<span class="nc" id="L221">        verify(listener, never()).onGaugeAdded(&quot;thing&quot;, gauge1);</span>
<span class="nc" id="L222">    }</span>

    @Test
    @SuppressWarnings(&quot;rawtypes&quot;)
    public void accessingACustomGaugeRegistersAndReusesIt() {
<span class="nc" id="L227">        final MetricRegistry.MetricSupplier&lt;Gauge&gt; supplier = () -&gt; gauge;</span>
<span class="nc" id="L228">        final Gauge gauge1 = registry.gauge(&quot;thing&quot;, supplier);</span>
<span class="nc" id="L229">        final Gauge gauge2 = registry.gauge(&quot;thing&quot;, supplier);</span>

<span class="nc" id="L231">        assertThat(gauge1).isExactlyInstanceOf(NoopMetricRegistry.NoopGauge.class);</span>
<span class="nc" id="L232">        assertThat(gauge2).isExactlyInstanceOf(NoopMetricRegistry.NoopGauge.class);</span>
<span class="nc" id="L233">        assertThat(gauge1).isSameAs(gauge2);</span>

<span class="nc" id="L235">        verify(listener, never()).onGaugeAdded(&quot;thing&quot;, gauge1);</span>
<span class="nc" id="L236">    }</span>


    @Test
    public void addingAListenerWithExistingMetricsDoesNotNotify() {
<span class="nc" id="L241">        registry.register(&quot;gauge&quot;, gauge);</span>
<span class="nc" id="L242">        registry.register(&quot;counter&quot;, counter);</span>
<span class="nc" id="L243">        registry.register(&quot;histogram&quot;, histogram);</span>
<span class="nc" id="L244">        registry.register(&quot;meter&quot;, meter);</span>
<span class="nc" id="L245">        registry.register(&quot;timer&quot;, timer);</span>

<span class="nc" id="L247">        final MetricRegistryListener other = mock(MetricRegistryListener.class);</span>
<span class="nc" id="L248">        registry.addListener(other);</span>

<span class="nc" id="L250">        verify(other, never()).onGaugeAdded(&quot;gauge&quot;, gauge);</span>
<span class="nc" id="L251">        verify(other, never()).onCounterAdded(&quot;counter&quot;, counter);</span>
<span class="nc" id="L252">        verify(other, never()).onHistogramAdded(&quot;histogram&quot;, histogram);</span>
<span class="nc" id="L253">        verify(other, never()).onMeterAdded(&quot;meter&quot;, meter);</span>
<span class="nc" id="L254">        verify(other, never()).onTimerAdded(&quot;timer&quot;, timer);</span>
<span class="nc" id="L255">    }</span>

    @Test
    public void aRemovedListenerDoesNotReceiveUpdates() {
<span class="nc" id="L259">        registry.register(&quot;gauge&quot;, gauge);</span>
<span class="nc" id="L260">        registry.removeListener(listener);</span>
<span class="nc" id="L261">        registry.register(&quot;gauge2&quot;, gauge);</span>

<span class="nc" id="L263">        verify(listener, never()).onGaugeAdded(&quot;gauge2&quot;, gauge);</span>
<span class="nc" id="L264">    }</span>

    @Test
    public void hasAMapOfRegisteredGauges() {
<span class="nc" id="L268">        registry.register(&quot;gauge&quot;, gauge);</span>

<span class="nc" id="L270">        assertThat(registry.getGauges()).isEmpty();</span>
<span class="nc" id="L271">    }</span>

    @Test
    public void hasAMapOfRegisteredCounters() {
<span class="nc" id="L275">        registry.register(&quot;counter&quot;, counter);</span>

<span class="nc" id="L277">        assertThat(registry.getCounters()).isEmpty();</span>
<span class="nc" id="L278">    }</span>

    @Test
    public void hasAMapOfRegisteredHistograms() {
<span class="nc" id="L282">        registry.register(&quot;histogram&quot;, histogram);</span>

<span class="nc" id="L284">        assertThat(registry.getHistograms()).isEmpty();</span>
<span class="nc" id="L285">    }</span>

    @Test
    public void hasAMapOfRegisteredMeters() {
<span class="nc" id="L289">        registry.register(&quot;meter&quot;, meter);</span>

<span class="nc" id="L291">        assertThat(registry.getMeters()).isEmpty();</span>
<span class="nc" id="L292">    }</span>

    @Test
    public void hasAMapOfRegisteredTimers() {
<span class="nc" id="L296">        registry.register(&quot;timer&quot;, timer);</span>

<span class="nc" id="L298">        assertThat(registry.getTimers()).isEmpty();</span>
<span class="nc" id="L299">    }</span>

    @Test
    public void hasASetOfRegisteredMetricNames() {
<span class="nc" id="L303">        registry.register(&quot;gauge&quot;, gauge);</span>
<span class="nc" id="L304">        registry.register(&quot;counter&quot;, counter);</span>
<span class="nc" id="L305">        registry.register(&quot;histogram&quot;, histogram);</span>
<span class="nc" id="L306">        registry.register(&quot;meter&quot;, meter);</span>
<span class="nc" id="L307">        registry.register(&quot;timer&quot;, timer);</span>

<span class="nc" id="L309">        assertThat(registry.getNames()).isEmpty();</span>
<span class="nc" id="L310">    }</span>

    @Test
    public void doesNotRegisterMultipleMetrics() {
<span class="nc" id="L314">        final MetricSet metrics = () -&gt; {</span>
<span class="nc" id="L315">            final Map&lt;String, Metric&gt; m = new HashMap&lt;&gt;();</span>
<span class="nc" id="L316">            m.put(&quot;gauge&quot;, gauge);</span>
<span class="nc" id="L317">            m.put(&quot;counter&quot;, counter);</span>
<span class="nc" id="L318">            return m;</span>
        };

<span class="nc" id="L321">        registry.registerAll(metrics);</span>

<span class="nc" id="L323">        assertThat(registry.getNames()).isEmpty();</span>
<span class="nc" id="L324">    }</span>

    @Test
    public void doesNotRegisterMultipleMetricsWithAPrefix() {
<span class="nc" id="L328">        final MetricSet metrics = () -&gt; {</span>
<span class="nc" id="L329">            final Map&lt;String, Metric&gt; m = new HashMap&lt;&gt;();</span>
<span class="nc" id="L330">            m.put(&quot;gauge&quot;, gauge);</span>
<span class="nc" id="L331">            m.put(&quot;counter&quot;, counter);</span>
<span class="nc" id="L332">            return m;</span>
        };

<span class="nc" id="L335">        registry.register(&quot;my&quot;, metrics);</span>

<span class="nc" id="L337">        assertThat(registry.getNames()).isEmpty();</span>
<span class="nc" id="L338">    }</span>

    @Test
    public void doesNotRegisterRecursiveMetricSets() {
<span class="nc" id="L342">        final MetricSet inner = () -&gt; {</span>
<span class="nc" id="L343">            final Map&lt;String, Metric&gt; m = new HashMap&lt;&gt;();</span>
<span class="nc" id="L344">            m.put(&quot;gauge&quot;, gauge);</span>
<span class="nc" id="L345">            return m;</span>
        };

<span class="nc" id="L348">        final MetricSet outer = () -&gt; {</span>
<span class="nc" id="L349">            final Map&lt;String, Metric&gt; m = new HashMap&lt;&gt;();</span>
<span class="nc" id="L350">            m.put(&quot;inner&quot;, inner);</span>
<span class="nc" id="L351">            m.put(&quot;counter&quot;, counter);</span>
<span class="nc" id="L352">            return m;</span>
        };

<span class="nc" id="L355">        registry.register(&quot;my&quot;, outer);</span>

<span class="nc" id="L357">        assertThat(registry.getNames()).isEmpty();</span>
<span class="nc" id="L358">    }</span>

    @Test
    public void doesNotRegisterMetricsFromAnotherRegistry() {
<span class="nc" id="L362">        MetricRegistry other = new MetricRegistry();</span>
<span class="nc" id="L363">        other.register(&quot;gauge&quot;, gauge);</span>
<span class="nc" id="L364">        registry.register(&quot;nested&quot;, other);</span>
<span class="nc" id="L365">        assertThat(registry.getNames()).isEmpty();</span>
<span class="nc" id="L366">    }</span>

    @Test
    public void removesMetricsMatchingAFilter() {
<span class="nc" id="L370">        registry.timer(&quot;timer-1&quot;);</span>
<span class="nc" id="L371">        registry.timer(&quot;timer-2&quot;);</span>
<span class="nc" id="L372">        registry.histogram(&quot;histogram-1&quot;);</span>

<span class="nc" id="L374">        assertThat(registry.getNames()).isEmpty();</span>

<span class="nc" id="L376">        registry.removeMatching((name, metric) -&gt; name.endsWith(&quot;1&quot;));</span>

<span class="nc" id="L378">        assertThat(registry.getNames()).isEmpty();</span>

<span class="nc" id="L380">        verify(listener, never()).onTimerRemoved(&quot;timer-1&quot;);</span>
<span class="nc" id="L381">        verify(listener, never()).onHistogramRemoved(&quot;histogram-1&quot;);</span>
<span class="nc" id="L382">    }</span>

    @Test
    public void addingChildMetricAfterRegister() {
<span class="nc" id="L386">        MetricRegistry parent = new NoopMetricRegistry();</span>
<span class="nc" id="L387">        MetricRegistry child = new MetricRegistry();</span>

<span class="nc" id="L389">        child.counter(&quot;test-1&quot;);</span>
<span class="nc" id="L390">        parent.register(&quot;child&quot;, child);</span>
<span class="nc" id="L391">        child.counter(&quot;test-2&quot;);</span>

<span class="nc" id="L393">        assertThat(parent.getMetrics()).isEmpty();</span>
<span class="nc" id="L394">    }</span>

    @Test
    public void addingMultipleChildMetricsAfterRegister() {
<span class="nc" id="L398">        MetricRegistry parent = new NoopMetricRegistry();</span>
<span class="nc" id="L399">        MetricRegistry child = new MetricRegistry();</span>

<span class="nc" id="L401">        child.counter(&quot;test-1&quot;);</span>
<span class="nc" id="L402">        child.counter(&quot;test-2&quot;);</span>
<span class="nc" id="L403">        parent.register(&quot;child&quot;, child);</span>
<span class="nc" id="L404">        child.counter(&quot;test-3&quot;);</span>
<span class="nc" id="L405">        child.counter(&quot;test-4&quot;);</span>

<span class="nc" id="L407">        assertThat(parent.getMetrics()).isEmpty();</span>
<span class="nc" id="L408">    }</span>

    @Test
    public void addingDeepChildMetricsAfterRegister() {
<span class="nc" id="L412">        MetricRegistry parent = new NoopMetricRegistry();</span>
<span class="nc" id="L413">        MetricRegistry child = new MetricRegistry();</span>
<span class="nc" id="L414">        MetricRegistry deepChild = new MetricRegistry();</span>

<span class="nc" id="L416">        deepChild.counter(&quot;test-1&quot;);</span>
<span class="nc" id="L417">        child.register(&quot;deep-child&quot;, deepChild);</span>
<span class="nc" id="L418">        deepChild.counter(&quot;test-2&quot;);</span>

<span class="nc" id="L420">        child.counter(&quot;test-3&quot;);</span>
<span class="nc" id="L421">        parent.register(&quot;child&quot;, child);</span>
<span class="nc" id="L422">        child.counter(&quot;test-4&quot;);</span>

<span class="nc" id="L424">        deepChild.counter(&quot;test-5&quot;);</span>

<span class="nc" id="L426">        assertThat(parent.getMetrics()).isEmpty();</span>
<span class="nc" id="L427">        assertThat(deepChild.getMetrics()).hasSize(3);</span>
<span class="nc" id="L428">        assertThat(child.getMetrics()).hasSize(5);</span>
<span class="nc" id="L429">    }</span>

    @Test
    public void removingChildMetricAfterRegister() {
<span class="nc" id="L433">        MetricRegistry parent = new NoopMetricRegistry();</span>
<span class="nc" id="L434">        MetricRegistry child = new MetricRegistry();</span>

<span class="nc" id="L436">        child.counter(&quot;test-1&quot;);</span>
<span class="nc" id="L437">        parent.register(&quot;child&quot;, child);</span>
<span class="nc" id="L438">        child.counter(&quot;test-2&quot;);</span>

<span class="nc" id="L440">        child.remove(&quot;test-1&quot;);</span>

<span class="nc" id="L442">        assertThat(parent.getMetrics()).isEmpty();</span>
<span class="nc" id="L443">        assertThat(child.getMetrics()).doesNotContainKey(&quot;test-1&quot;);</span>
<span class="nc" id="L444">    }</span>

    @Test
    public void removingMultipleChildMetricsAfterRegister() {
<span class="nc" id="L448">        MetricRegistry parent = new NoopMetricRegistry();</span>
<span class="nc" id="L449">        MetricRegistry child = new MetricRegistry();</span>

<span class="nc" id="L451">        child.counter(&quot;test-1&quot;);</span>
<span class="nc" id="L452">        child.counter(&quot;test-2&quot;);</span>
<span class="nc" id="L453">        parent.register(&quot;child&quot;, child);</span>
<span class="nc" id="L454">        child.counter(&quot;test-3&quot;);</span>
<span class="nc" id="L455">        child.counter(&quot;test-4&quot;);</span>

<span class="nc" id="L457">        child.remove(&quot;test-1&quot;);</span>
<span class="nc" id="L458">        child.remove(&quot;test-3&quot;);</span>

<span class="nc" id="L460">        assertThat(parent.getMetrics()).isEmpty();</span>
<span class="nc" id="L461">        assertThat(child.getMetrics()).doesNotContainKeys(&quot;test-1&quot;, &quot;test-3&quot;);</span>
<span class="nc" id="L462">    }</span>

    @Test
    public void removingDeepChildMetricsAfterRegister() {
<span class="nc" id="L466">        MetricRegistry parent = new NoopMetricRegistry();</span>
<span class="nc" id="L467">        MetricRegistry child = new MetricRegistry();</span>
<span class="nc" id="L468">        MetricRegistry deepChild = new MetricRegistry();</span>

<span class="nc" id="L470">        deepChild.counter(&quot;test-1&quot;);</span>
<span class="nc" id="L471">        child.register(&quot;deep-child&quot;, deepChild);</span>
<span class="nc" id="L472">        deepChild.counter(&quot;test-2&quot;);</span>

<span class="nc" id="L474">        child.counter(&quot;test-3&quot;);</span>
<span class="nc" id="L475">        parent.register(&quot;child&quot;, child);</span>
<span class="nc" id="L476">        child.counter(&quot;test-4&quot;);</span>

<span class="nc" id="L478">        deepChild.remove(&quot;test-2&quot;);</span>

<span class="nc" id="L480">        Set&lt;String&gt; childMetrics = child.getMetrics().keySet();</span>
<span class="nc" id="L481">        Set&lt;String&gt; deepChildMetrics = deepChild.getMetrics().keySet();</span>

<span class="nc" id="L483">        assertThat(parent.getMetrics()).isEmpty();</span>
<span class="nc" id="L484">        assertThat(deepChildMetrics).hasSize(1);</span>
<span class="nc" id="L485">        assertThat(childMetrics).hasSize(3);</span>
<span class="nc" id="L486">    }</span>

    @Test
    public void registerNullMetric() {
<span class="nc" id="L490">        MetricRegistry registry = new NoopMetricRegistry();</span>
<span class="nc" id="L491">        assertThatNullPointerException()</span>
<span class="nc" id="L492">                .isThrownBy(() -&gt; registry.register(&quot;any_name&quot;, null))</span>
<span class="nc" id="L493">                .withMessage(&quot;metric == null&quot;);</span>
<span class="nc" id="L494">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>